# 系统参数功能设计文档

## 1. 功能概述

系统参数模块是财务管理系统的核心配置中心，用于管理系统运行所需的各类配置参数。该模块提供了参数的分类管理、动态配置、权限控制等功能，确保系统能够灵活适应不同企业的业务需求。

## 2. 功能架构

### 2.1 参数分类体系

根据财务管理系统的业务特点，系统参数分为以下几个主要类别：

#### 2.1.1 基础设置参数
- **企业信息**
  - 企业名称
  - 企业代码
  - 税号
  - 法人代表
  - 注册地址
  - 联系方式

- **会计制度**
  - 会计准则（企业会计准则/小企业会计准则）
  - 会计政策
  - 记账本位币
  - 账套启用日期

#### 2.1.2 财务核算参数
- **凭证设置**
  - 凭证字设置（记、收、付、转）
  - 凭证号规则（按年度/按月份/连续编号）
  - 凭证自动编号
  - 凭证审核流程
  - 摘要库维护

- **科目设置**
  - 科目编码规则（4-2-2-2）
  - 科目级次设置
  - 辅助核算项目
  - 现金流量项目
  - 数量核算设置

- **期末处理**
  - 结转损益科目设置
  - 汇兑损益科目设置
  - 期末调汇设置
  - 自动转账设置

#### 2.1.3 往来管理参数
- **客户管理**
  - 客户编码规则
  - 信用控制
  - 账期设置
  - 对账单格式

- **供应商管理**
  - 供应商编码规则
  - 付款条件
  - 采购流程
  - 发票管理

#### 2.1.4 报表参数
- **财务报表**
  - 资产负债表格式
  - 利润表格式
  - 现金流量表编制方法
  - 报表审计要求

- **管理报表**
  - 部门费用分析
  - 项目成本核算
  - 预算执行分析
  - 经营分析报表

#### 2.1.5 系统管理参数
- **安全设置**
  - 密码策略（长度、复杂度、有效期）
  - 登录控制（失败次数、锁定时间）
  - 会话超时设置
  - IP访问限制

- **日志设置**
  - 操作日志级别
  - 日志保留期限
  - 日志归档策略
  - 审计跟踪设置

- **备份设置**
  - 自动备份策略
  - 备份保留期限
  - 备份存储位置
  - 数据恢复设置

#### 2.1.6 接口集成参数
- **数据导入导出**
  - Excel模板设置
  - 导入校验规则
  - 导出格式设置
  - 批量处理参数

- **外部系统集成**
  - ERP接口配置
  - 银企直连参数
  - 税务系统对接
  - 电子发票接口

## 3. 界面设计

### 3.1 主界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  系统参数                                                    │
├─────────────┬───────────────────────────────────────────────┤
│             │  参数分类：[基础设置 ▼]                        │
│  参数分类   │                                               │
│             │  ┌─────────────────────────────────────────┐ │
│  ├ 基础设置  │  │ 参数名称        参数值        操作      │ │
│  ├ 财务核算  │  ├─────────────────────────────────────────┤ │
│  ├ 往来管理  │  │ 企业名称        XX公司         编辑     │ │
│  ├ 报表参数  │  │ 会计准则        企业会计准则    编辑     │ │
│  ├ 系统管理  │  │ 记账本位币      人民币          编辑     │ │
│  └ 接口集成  │  └─────────────────────────────────────────┘ │
│             │                                               │
│             │  [保存] [重置] [导出配置] [导入配置]          │
└─────────────┴───────────────────────────────────────────────┘
```

### 3.2 参数编辑界面

- 文本输入框：用于简单文本参数
- 下拉选择框：用于枚举类型参数
- 数字输入框：用于数值类型参数
- 开关按钮：用于布尔类型参数
- 日期选择器：用于日期类型参数
- JSON编辑器：用于复杂配置参数

### 3.3 功能按钮

- **保存**：保存当前修改的参数
- **重置**：恢复到上次保存的状态
- **导出配置**：导出当前参数配置为JSON文件
- **导入配置**：从JSON文件导入参数配置
- **历史记录**：查看参数修改历史
- **参数说明**：查看参数详细说明文档

## 4. 数据模型设计

### 4.1 参数存储结构

基于 `system_parameters` 表，扩展以下字段：

```sql
-- 系统参数扩展字段
ALTER TABLE system_parameters ADD COLUMN IF NOT EXISTS
    validation_rule VARCHAR(500) COMMENT '参数验证规则',
    min_value VARCHAR(50) COMMENT '最小值',
    max_value VARCHAR(50) COMMENT '最大值',
    options TEXT COMMENT '可选值列表(JSON格式)',
    default_value TEXT COMMENT '默认值',
    required TINYINT(1) DEFAULT 0 COMMENT '是否必填',
    visible TINYINT(1) DEFAULT 1 COMMENT '是否可见',
    editable TINYINT(1) DEFAULT 1 COMMENT '是否可编辑',
    effective_immediately TINYINT(1) DEFAULT 1 COMMENT '是否立即生效',
    restart_required TINYINT(1) DEFAULT 0 COMMENT '是否需要重启';
```

### 4.2 参数分类定义

```json
{
  "categories": [
    {
      "code": "BASIC",
      "name": "基础设置",
      "icon": "Setting",
      "sort": 1,
      "subcategories": [
        {
          "code": "COMPANY_INFO",
          "name": "企业信息",
          "parameters": [
            "company.name",
            "company.code",
            "company.tax_number"
          ]
        },
        {
          "code": "ACCOUNTING_POLICY",
          "name": "会计制度",
          "parameters": [
            "accounting.standard",
            "accounting.currency",
            "accounting.start_date"
          ]
        }
      ]
    }
  ]
}
```

### 4.3 参数定义示例

```json
{
  "param_key": "voucher.auto_number",
  "param_value": "true",
  "param_type": "BOOLEAN",
  "category": "FINANCIAL_ACCOUNTING",
  "description": "是否启用凭证自动编号",
  "default_value": "true",
  "options": null,
  "validation_rule": null,
  "required": true,
  "visible": true,
  "editable": true,
  "effective_immediately": true,
  "restart_required": false
}
```

## 5. 功能实现要点

### 5.1 参数加载机制

1. **启动加载**：系统启动时加载所有必需参数
2. **缓存机制**：使用Redis缓存常用参数，减少数据库访问
3. **动态刷新**：支持运行时刷新参数，无需重启系统
4. **默认值处理**：参数不存在时使用默认值

### 5.2 参数验证机制

1. **类型验证**：根据param_type进行类型校验
2. **范围验证**：数值类型检查min_value和max_value
3. **格式验证**：使用正则表达式验证特定格式
4. **业务验证**：调用业务规则进行复杂验证

### 5.3 权限控制

1. **查看权限**：控制参数的可见性
2. **修改权限**：控制参数的可编辑性
3. **审计日志**：记录所有参数修改操作
4. **变更审批**：重要参数修改需要审批

### 5.4 参数生效机制

1. **立即生效**：修改后立即生效的参数
2. **延迟生效**：需要特定时机才生效的参数
3. **重启生效**：需要系统重启才生效的参数
4. **通知机制**：参数变更通知相关模块

## 6. 接口设计

### 6.1 后端API接口

```
GET    /api/v1/system/parameters                # 获取参数列表
GET    /api/v1/system/parameters/{key}          # 获取单个参数
PUT    /api/v1/system/parameters/{key}          # 更新参数
POST   /api/v1/system/parameters/batch          # 批量更新参数
GET    /api/v1/system/parameters/categories     # 获取参数分类
GET    /api/v1/system/parameters/export         # 导出参数配置
POST   /api/v1/system/parameters/import         # 导入参数配置
GET    /api/v1/system/parameters/{key}/history  # 获取参数修改历史
POST   /api/v1/system/parameters/validate       # 验证参数值
```

### 6.2 前端服务接口

```javascript
// 系统参数API
export const systemParamApi = {
  // 获取参数列表
  getParameters(category) {
    return request.get('/v1/system/parameters', { params: { category } })
  },
  
  // 更新参数
  updateParameter(key, value) {
    return request.put(`/v1/system/parameters/${key}`, { value })
  },
  
  // 批量更新
  batchUpdate(parameters) {
    return request.post('/v1/system/parameters/batch', { parameters })
  },
  
  // 导出配置
  exportConfig() {
    return request.get('/v1/system/parameters/export', { responseType: 'blob' })
  },
  
  // 导入配置
  importConfig(file) {
    const formData = new FormData()
    formData.append('file', file)
    return request.post('/v1/system/parameters/import', formData)
  }
}
```

## 7. 安全考虑

### 7.1 参数加密

- 敏感参数（如密码、密钥）使用AES加密存储
- 传输过程使用HTTPS加密
- 前端显示时进行脱敏处理

### 7.2 访问控制

- 基于角色的访问控制（RBAC）
- 参数级别的权限控制
- 操作审计和追踪

### 7.3 数据验证

- 前端验证：基本格式和范围验证
- 后端验证：业务规则和安全验证
- 防止SQL注入和XSS攻击

## 8. 扩展性设计

### 8.1 参数模板

- 支持参数模板定义
- 快速应用行业最佳实践
- 参数配置导入导出

### 8.2 多租户支持

- 租户级参数隔离
- 全局参数和租户参数继承
- 参数覆盖机制

### 8.3 版本管理

- 参数配置版本控制
- 配置回滚功能
- 变更对比功能

## 9. 实施建议

### 9.1 初始化参数

系统部署时需要初始化的核心参数：

1. 企业基本信息
2. 会计准则和政策
3. 系统安全策略
4. 默认科目设置

### 9.2 参数维护

1. 定期审查参数设置
2. 备份重要参数配置
3. 记录参数变更原因
4. 测试参数变更影响

### 9.3 性能优化

1. 热点参数缓存
2. 批量更新优化
3. 异步加载机制
4. 参数预加载策略

## 10. 总结

系统参数模块是财务管理系统的基础设施，通过灵活的参数配置机制，可以满足不同企业的个性化需求。良好的参数管理不仅能提高系统的可维护性，还能显著提升用户体验和系统性能。