# 财务系统后端下一步开发指南

## 📊 当前项目状态总结

### ✅ 已完成基础架构（Week 1-2）
- ✅ Spring Boot项目搭建和配置
- ✅ MySQL数据库连接配置  
- ✅ 统一异常处理机制
- ✅ 参数校验框架配置
- ✅ CORS跨域支持
- ✅ 基础工具类（UUID、Validation）
- ✅ 统一响应格式（ResponseEntity）
- ✅ Spring Security基础配置
- ✅ BCrypt密码加密器

### 🔍 当前项目结构
```
backend/
├── src/main/java/com/company/financial/
│   ├── common/          # ✅ 通用响应类
│   ├── config/          # ✅ 配置类（Security、Validation）
│   ├── controller/      # ✅ 健康检查接口
│   ├── exception/       # ✅ 异常处理
│   ├── util/            # ✅ 工具类
│   │   └── validation/  # ✅ 自定义校验
│   ├── entity/          # ❌ 待开发
│   ├── dto/             # ❌ 待开发
│   ├── repository/      # ❌ 待开发
│   ├── service/         # ❌ 待开发
│   └── security/        # ❌ 待开发
```

---

## 🎯 下一步开发计划：用户权限模块（Week 3）

### 📋 开发任务列表

#### 1. **创建基础实体类** (4小时)
```java
// 需要创建的实体
- User.java          // 用户实体
- Role.java          // 角色实体  
- Permission.java    // 权限实体
- UserRole.java      // 用户角色关联
- RolePermission.java // 角色权限关联
```

#### 2. **创建数据库表结构** (2小时)
```sql
-- 执行MySQL数据库设计方案中的用户权限模块表
-- 文件位置：docs/MySQL数据库设计方案.md
```

#### 3. **创建Repository层** (2小时)
```java
- UserRepository
- RoleRepository
- PermissionRepository
- UserRoleRepository
- RolePermissionRepository
```

#### 4. **创建DTO对象** (3小时)
```java
// 请求DTO
- LoginRequestDTO      // 登录请求
- RegisterRequestDTO   // 注册请求
- ChangePasswordDTO    // 修改密码

// 响应DTO
- UserInfoDTO         // 用户信息
- LoginResponseDTO    // 登录响应（含token）
```

#### 5. **实现JWT认证服务** (6小时)
```java
- JwtTokenProvider     // JWT工具类
- JwtAuthenticationFilter // JWT认证过滤器
- CustomUserDetails    // 自定义用户详情
- CustomUserDetailsService // 用户详情服务
```

#### 6. **实现用户服务** (4小时)
```java
- UserService         // 用户业务逻辑
- AuthService         // 认证业务逻辑
- PermissionService   // 权限业务逻辑
```

#### 7. **创建认证控制器** (3小时)
```java
- AuthController      // 认证相关接口
  - POST /api/auth/login    // 登录
  - POST /api/auth/register // 注册
  - POST /api/auth/logout   // 登出
  - GET  /api/auth/me       // 当前用户信息
```

#### 8. **更新Security配置** (2小时)
- 配置JWT认证过滤器
- 配置认证异常处理
- 配置权限控制规则

---

## 📝 开发步骤指导

### Step 1: 创建实体类
先从 `docs/MySQL数据库设计方案.md` 中复制用户权限模块的表结构，创建对应的JPA实体类。

### Step 2: 初始化数据库
```sql
-- 创建数据库（如果还没有）
CREATE DATABASE IF NOT EXISTS financial_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 使用数据库
USE financial_db;

-- 执行用户权限模块的建表SQL
```

### Step 3: 实现基础CRUD
1. 创建Repository接口
2. 创建Service层基础CRUD方法
3. 编写单元测试验证

### Step 4: 实现JWT认证
1. 添加JWT依赖（已在pom.xml中）
2. 创建JWT工具类
3. 实现认证过滤器
4. 集成到Spring Security

### Step 5: 实现业务接口
1. 用户注册逻辑
2. 用户登录逻辑
3. Token刷新逻辑
4. 权限验证逻辑

---

## 🔧 开发规范提醒

### 1. **实体类规范**
```java
@Entity
@Table(name = "users")
@Data
@Slf4j
public class User {
    @Id
    @GeneratedValue(generator = "uuid")
    @GenericGenerator(name = "uuid", strategy = "uuid2")
    private String id;
    
    // 审计字段
    @CreationTimestamp
    private LocalDateTime createdAt;
    
    @UpdateTimestamp
    private LocalDateTime updatedAt;
    
    // ... 其他字段
}
```

### 2. **Service层规范**
```java
@Service
@Slf4j
@Transactional
public class UserService {
    // 使用构造器注入
    private final UserRepository userRepository;
    
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
    
    // 业务方法
}
```

### 3. **Controller层规范**
```java
@RestController
@RequestMapping("/api/users")
@Slf4j
@Validated
public class UserController {
    
    @GetMapping
    @PreAuthorize("hasAuthority('USER_READ')")
    public ResponseEntity<List<UserInfoDTO>> list() {
        // 实现逻辑
    }
}
```

### 4. **异常处理规范**
- 使用已定义的异常类
- 不要捕获异常后不处理
- 记录必要的日志

---

## 📅 时间安排建议

### Day 1（第一天）
- 上午：创建实体类和数据库表
- 下午：实现Repository层和基础Service

### Day 2（第二天）
- 上午：实现JWT认证组件
- 下午：集成Spring Security

### Day 3（第三天）
- 上午：实现用户注册/登录逻辑
- 下午：实现权限控制和测试

### Day 4（第四天）
- 上午：完善细节和边界情况
- 下午：编写单元测试

### Day 5（第五天）
- 整体测试和优化
- 准备进入下一个模块

---

## ✅ 完成标准

1. **功能完整性**
   - 用户可以注册新账号
   - 用户可以登录获取Token
   - Token可以正确验证
   - 权限控制正常工作

2. **代码质量**
   - 遵循项目编码规范
   - 适当的异常处理
   - 必要的参数校验
   - 日志记录完整

3. **测试覆盖**
   - 核心业务逻辑有单元测试
   - API接口经过测试验证
   - 异常情况得到处理

---

## 🚀 快速开始

1. **先创建第一个实体类**
   ```bash
   # 创建User实体
   backend/src/main/java/com/company/financial/entity/User.java
   ```

2. **创建对应的Repository**
   ```bash
   # 创建UserRepository
   backend/src/main/java/com/company/financial/repository/UserRepository.java
   ```

3. **运行项目验证**
   ```bash
   cd backend
   mvn spring-boot:run
   ```

---

**准备好了吗？** 让我们开始Week 3的用户权限模块开发！

如果需要任何帮助，请随时告诉我：
- 需要具体的代码实现示例
- 遇到技术问题需要解决
- 需要调整开发计划

祝开发顺利！🎉