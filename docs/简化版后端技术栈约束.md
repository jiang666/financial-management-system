# è´¢åŠ¡ç³»ç»Ÿåç«¯æŠ€æœ¯æ ˆçº¦æŸ (ç®€åŒ–ç‰ˆ)

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æ ˆ

### å¿…é¡»ä½¿ç”¨çš„æŠ€æœ¯
```
## æ ¸å¿ƒæ¡†æ¶
- Spring Boot 2.7.6 (ä¸»æ¡†æ¶)
- Spring Data JPA (æ•°æ®åº“æŒä¹…å±‚)
- Spring Security (æƒé™è®¤è¯)
- Lombok (ç®€åŒ–ä»£ç æ³¨è§£)
- @Slf4j (æ—¥å¿—æ³¨è§£)

## æ•°æ®åº“
- MySQL (å”¯ä¸€æ•°æ®åº“ï¼Œå­˜å‚¨æ‰€æœ‰æ•°æ®)

## è®¤è¯æˆæƒ
- JWT Tokenè®¤è¯
- BCryptPasswordEncoderå¯†ç åŠ å¯†
```

---

## ğŸ“‹ æ•°æ®åº“è®¾è®¡è§„èŒƒ

### MySQLè¡¨ç»“æ„æ ‡å‡†
```sql
-- æ ‡å‡†è¡¨ç»“æ„æ¨¡æ¿
CREATE TABLE table_name (
    -- 1. ä¸»é”®å¿…é¡»ä¸ºUUID
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    
    -- 2. ä¸šåŠ¡å­—æ®µ
    field_name VARCHAR(100) NOT NULL,
    
    -- 3. å®¡è®¡å­—æ®µ(å¿…é¡»)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    
    -- 4. é€»è¾‘åˆ é™¤(æ¨è)
    deleted BOOLEAN DEFAULT FALSE,
    
    -- 5. ç‰ˆæœ¬æ§åˆ¶(ä¹è§‚é”)
    version INT DEFAULT 0,
    
    -- 6. ç´¢å¼•
    INDEX idx_created_at (created_at),
    INDEX idx_field_name (field_name)
);
```

### æ•°æ®å­˜å‚¨åˆ†ç±»
```sql
-- 1. æ ¸å¿ƒä¸šåŠ¡æ•°æ®è¡¨
chart_of_accounts     -- ä¼šè®¡ç§‘ç›®
vouchers             -- å‡­è¯
voucher_entries      -- å‡­è¯åˆ†å½•
customers            -- å®¢æˆ·
suppliers            -- ä¾›åº”å•†
invoices             -- å‘ç¥¨

-- 2. ç³»ç»Ÿç®¡ç†è¡¨
users                -- ç”¨æˆ·
roles                -- è§’è‰²
permissions          -- æƒé™
user_roles           -- ç”¨æˆ·è§’è‰²å…³è”

-- 3. ç³»ç»Ÿæ—¥å¿—è¡¨ (æ›¿ä»£MongoDB)
system_logs          -- ç³»ç»Ÿæ“ä½œæ—¥å¿—
audit_trails         -- æ•°æ®å®¡è®¡è®°å½•
login_logs           -- ç™»å½•æ—¥å¿—

-- 4. é…ç½®è¡¨
system_configs       -- ç³»ç»Ÿé…ç½®
exchange_rates       -- æ±‡ç‡
currencies           -- å¸ç§
```

---

## ğŸ¯ å®ä½“ç±»è§„èŒƒ

### æ ‡å‡†å®ä½“ç±»æ¨¡æ¿
```java
@Entity
@Table(name = "table_name")
@Data
@Slf4j
public class EntityName {
    
    @Id
    @GeneratedValue(generator = "uuid")
    @GenericGenerator(name = "uuid", strategy = "uuid2")
    private String id;
    
    // ä¸šåŠ¡å­—æ®µ
    @Column(nullable = false, length = 100)
    private String fieldName;
    
    // å®¡è®¡å­—æ®µ
    @CreationTimestamp
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;
    
    @UpdateTimestamp
    @Column(name = "updated_at", nullable = false)
    private LocalDateTime updatedAt;
    
    @Column(name = "created_by", length = 36)
    private String createdBy;
    
    @Column(name = "updated_by", length = 36)
    private String updatedBy;
    
    // é€»è¾‘åˆ é™¤
    @Column(nullable = false)
    private Boolean deleted = false;
    
    // ç‰ˆæœ¬æ§åˆ¶
    @Version
    private Integer version = 0;
}
```

### Repositoryæ ‡å‡†
```java
public interface EntityRepository extends JpaRepository<EntityName, String> {
    
    // æŸ¥è¯¢æœªåˆ é™¤çš„è®°å½•
    List<EntityName> findByDeletedFalse();
    
    // æŒ‰æ¡ä»¶æŸ¥è¯¢
    @Query("SELECT e FROM EntityName e WHERE e.deleted = false AND e.fieldName = :value")
    List<EntityName> findByFieldName(@Param("value") String value);
    
    // åˆ†é¡µæŸ¥è¯¢
    Page<EntityName> findByDeletedFalseOrderByCreatedAtDesc(Pageable pageable);
}
```

---

## ğŸ”’ æ¥å£è¿”å›è§„èŒƒ

### ç»Ÿä¸€å“åº”æ ¼å¼
```java
// æˆåŠŸå“åº”
return ResponseEntity.success(data);

// å¤±è´¥å“åº”
return ResponseEntity.fail("é”™è¯¯ä¿¡æ¯");

// åˆ†é¡µå“åº”
ResponsePageDataEntity<User> pageData = new ResponsePageDataEntity<>();
pageData.setTotal(total);
pageData.setRows(userList);
return ResponseEntity.success(pageData);
```

### Controlleræ ‡å‡†æ¨¡æ¿
```java
@RestController
@RequestMapping("/api/entity")
@Slf4j
public class EntityController {
    
    @Autowired
    private EntityService entityService;
    
    @GetMapping
    @PreAuthorize("hasPermission('entity', 'read')")
    public ResponseEntity<List<EntityName>> list() {
        List<EntityName> entities = entityService.findAll();
        log.info("æŸ¥è¯¢å®ä½“åˆ—è¡¨ï¼Œè¿”å›{}æ¡è®°å½•", entities.size());
        return ResponseEntity.success(entities);
    }
    
    @PostMapping
    @PreAuthorize("hasPermission('entity', 'create')")
    public ResponseEntity<EntityName> create(@Valid @RequestBody EntityDTO dto) {
        EntityName entity = entityService.create(dto);
        log.info("åˆ›å»ºå®ä½“æˆåŠŸï¼ŒID: {}", entity.getId());
        return ResponseEntity.success(entity);
    }
}
```

---

## ğŸ“ æ—¥å¿—ç®¡ç†è§„èŒƒ

### ç³»ç»Ÿæ—¥å¿—è¡¨è®¾è®¡
```sql
CREATE TABLE system_logs (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36),
    username VARCHAR(50),
    module VARCHAR(50) NOT NULL,
    operation VARCHAR(100) NOT NULL,
    description TEXT,
    ip_address VARCHAR(45),
    user_agent TEXT,
    request_url VARCHAR(500),
    request_method VARCHAR(10),
    response_status INTEGER,
    execution_time BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_module (module),
    INDEX idx_created_at (created_at)
);
```

### æ—¥å¿—è®°å½•æœåŠ¡
```java
@Service
@Slf4j
public class SystemLogService {
    
    @Autowired
    private SystemLogRepository logRepository;
    
    @Async
    public void recordOperation(String userId, String module, String operation, 
                               String description, HttpServletRequest request) {
        SystemLog systemLog = new SystemLog();
        systemLog.setUserId(userId);
        systemLog.setModule(module);
        systemLog.setOperation(operation);
        systemLog.setDescription(description);
        systemLog.setIpAddress(getClientIpAddress(request));
        systemLog.setUserAgent(request.getHeader("User-Agent"));
        systemLog.setRequestUrl(request.getRequestURL().toString());
        systemLog.setRequestMethod(request.getMethod());
        
        logRepository.save(systemLog);
        log.debug("è®°å½•ç³»ç»Ÿæ—¥å¿—: {}", description);
    }
}
```

---

## âœ… å¼€å‘æ£€æŸ¥æ¸…å•

### åŸºç¡€æ£€æŸ¥
- [ ] ä½¿ç”¨Spring Boot + JPA + Security
- [ ] ä»…ä½¿ç”¨MySQLæ•°æ®åº“
- [ ] æ‰€æœ‰ç±»ä½¿ç”¨@Slf4jæ³¨è§£
- [ ] å®ä½“ç±»ä½¿ç”¨UUIDä¸»é”®
- [ ] åŒ…å«å®Œæ•´å®¡è®¡å­—æ®µ

### æ•°æ®åº“æ£€æŸ¥
- [ ] è¡¨åä½¿ç”¨snake_case
- [ ] é‡è¦å­—æ®µå»ºç«‹ç´¢å¼•
- [ ] å¤–é”®å…³ç³»æ­£ç¡®è®¾ç½®
- [ ] ç³»ç»Ÿæ—¥å¿—è¡¨è®¾è®¡å®Œæ•´

### ä»£ç è´¨é‡æ£€æŸ¥
- [ ] æ¥å£ä½¿ç”¨ResponseEntityè¿”å›
- [ ] æƒé™æ§åˆ¶ä½¿ç”¨@PreAuthorize
- [ ] å¼‚å¸¸å¤„ç†ç»Ÿä¸€è§„èŒƒ
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥80%

### å®‰å…¨æ£€æŸ¥
- [ ] JWTè®¤è¯é…ç½®æ­£ç¡®
- [ ] å¯†ç BCryptåŠ å¯†
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] æ•æ„Ÿæ•°æ®è„±æ•

---

## ğŸš« ç¦ç”¨æŠ€æœ¯æ¸…å•

```
âŒ MongoDB (æ”¹ä¸ºMySQLå­˜å‚¨)
âŒ PostgreSQL (æ”¹ä¸ºMySQLå­˜å‚¨)
âŒ Redis (æš‚ä¸ä½¿ç”¨ç¼“å­˜)
âŒ MyBatis (å¿…é¡»ç”¨JPA)
âŒ Swagger (æš‚ä¸ç”Ÿæˆæ–‡æ¡£)
âŒ Shiro (å¿…é¡»ç”¨Spring Security)
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: V2.0 (ç®€åŒ–ç‰ˆ)  
**æ›´æ–°æ—¥æœŸ**: 2025-01-19  
**é€‚ç”¨é¡¹ç›®**: å†…éƒ¨è´¢åŠ¡ç®¡ç†ç³»ç»Ÿåç«¯