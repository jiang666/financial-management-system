# 财务管理系统完整数据库表结构设计

## 📊 设计概述

基于前端页面深度分析和现有数据库设计，创建完整的财务管理系统数据库表结构。

### 核心设计原则
- **业务完整性**: 覆盖所有前端页面功能需求
- **数据一致性**: 强一致性约束保证财务数据准确性  
- **扩展性**: 支持业务功能扩展和数据量增长
- **审计性**: 完整的审计跟踪和数据变更记录
- **性能优化**: 合理索引设计支持高效查询

---

## 🗂️ 模块化表结构设计

### 1. 基础设置模块

#### 1.1 用户权限管理
```sql
-- 已有表结构 (01_user_permission_tables.sql)
-- users, roles, permissions, user_roles, role_permissions
```

#### 1.2 组织架构管理
```sql
-- 部门表
CREATE TABLE departments (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    dept_code VARCHAR(20) NOT NULL UNIQUE COMMENT '部门编码',
    dept_name VARCHAR(100) NOT NULL COMMENT '部门名称',
    parent_id VARCHAR(36) COMMENT '父级部门ID',
    dept_type ENUM('公司', '部门', '小组') DEFAULT '部门' COMMENT '部门类型',
    manager_id VARCHAR(36) COMMENT '负责人用户ID',
    phone VARCHAR(20) COMMENT '部门电话',
    level INT NOT NULL DEFAULT 1 COMMENT '部门层级',
    sort_order INT DEFAULT 0 COMMENT '排序',
    status ENUM('启用', '停用') DEFAULT '启用' COMMENT '状态',
    description TEXT COMMENT '部门描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_dept_code (dept_code),
    INDEX idx_parent_id (parent_id),
    INDEX idx_manager_id (manager_id),
    INDEX idx_status (status),
    FOREIGN KEY (parent_id) REFERENCES departments(id),
    FOREIGN KEY (manager_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='部门表';

-- 岗位表
CREATE TABLE positions (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    dept_id VARCHAR(36) NOT NULL COMMENT '部门ID',
    position_name VARCHAR(100) NOT NULL COMMENT '岗位名称',
    position_level ENUM('高级', '中级', '初级') DEFAULT '中级' COMMENT '岗位级别',
    planned_count INT DEFAULT 1 COMMENT '计划人数',
    actual_count INT DEFAULT 0 COMMENT '实际人数',
    base_salary DECIMAL(10,2) DEFAULT 0 COMMENT '基础薪资',
    status ENUM('启用', '停用') DEFAULT '启用',
    description TEXT COMMENT '岗位描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_dept_id (dept_id),
    INDEX idx_status (status),
    FOREIGN KEY (dept_id) REFERENCES departments(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='岗位表';

-- 员工表  
CREATE TABLE employees (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) UNIQUE COMMENT '关联用户ID',
    employee_no VARCHAR(20) UNIQUE NOT NULL COMMENT '员工工号',
    employee_name VARCHAR(50) NOT NULL COMMENT '员工姓名',
    dept_id VARCHAR(36) NOT NULL COMMENT '部门ID',
    position_id VARCHAR(36) COMMENT '岗位ID',
    phone VARCHAR(20) COMMENT '手机号',
    email VARCHAR(100) COMMENT '邮箱',
    hire_date DATE COMMENT '入职日期',
    leave_date DATE COMMENT '离职日期',
    status ENUM('在职', '离职', '试用') DEFAULT '试用' COMMENT '员工状态',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_employee_no (employee_no),
    INDEX idx_dept_id (dept_id),
    INDEX idx_position_id (position_id),
    INDEX idx_status (status),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (dept_id) REFERENCES departments(id),
    FOREIGN KEY (position_id) REFERENCES positions(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='员工表';
```

#### 1.3 辅助核算设置
```sql
-- 辅助核算项目表
CREATE TABLE auxiliary_items (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    aux_type ENUM('部门', '客户', '供应商', '项目', '个人', '自定义') NOT NULL COMMENT '辅助核算类型',
    aux_code VARCHAR(20) NOT NULL COMMENT '辅助项目编码',
    aux_name VARCHAR(100) NOT NULL COMMENT '辅助项目名称',
    contact_person VARCHAR(50) COMMENT '联系人',
    phone VARCHAR(20) COMMENT '联系电话',
    address TEXT COMMENT '地址',
    manager VARCHAR(50) COMMENT '负责人',
    budget DECIMAL(15,2) COMMENT '预算金额',
    start_date DATE COMMENT '开始日期',
    deadline DATE COMMENT '截止日期',
    status ENUM('启用', '停用') DEFAULT '启用',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    UNIQUE KEY uk_aux_type_code (aux_type, aux_code),
    INDEX idx_aux_type (aux_type),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='辅助核算项目表';
```

#### 1.4 币种汇率管理
```sql
-- 币种表
CREATE TABLE currencies (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    currency_code VARCHAR(3) UNIQUE NOT NULL COMMENT '币种代码',
    currency_name VARCHAR(50) NOT NULL COMMENT '币种名称',
    currency_symbol VARCHAR(10) NOT NULL COMMENT '币种符号',
    exchange_rate DECIMAL(10,4) DEFAULT 1.0000 COMMENT '当前汇率',
    is_base BOOLEAN DEFAULT FALSE COMMENT '是否基准币种',
    decimal_places TINYINT DEFAULT 2 COMMENT '小数位数',
    status ENUM('启用', '停用') DEFAULT '启用',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_currency_code (currency_code),
    INDEX idx_is_base (is_base),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='币种表';

-- 汇率历史表
CREATE TABLE exchange_rate_history (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    currency_code VARCHAR(3) NOT NULL COMMENT '币种代码',
    rate DECIMAL(10,4) NOT NULL COMMENT '汇率',
    change_amount DECIMAL(10,4) DEFAULT 0 COMMENT '变动金额',
    change_percent DECIMAL(6,4) DEFAULT 0 COMMENT '变动百分比',
    rate_date DATE NOT NULL COMMENT '汇率日期',
    operator VARCHAR(50) COMMENT '操作员',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_currency_date (currency_code, rate_date),
    INDEX idx_rate_date (rate_date),
    FOREIGN KEY (currency_code) REFERENCES currencies(currency_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='汇率历史表';
```

#### 1.5 系统参数设置
```sql
-- 系统参数表
CREATE TABLE system_settings (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    setting_group VARCHAR(50) NOT NULL COMMENT '参数分组',
    setting_key VARCHAR(100) NOT NULL COMMENT '参数键',
    setting_value TEXT COMMENT '参数值',
    setting_type ENUM('string', 'number', 'boolean', 'json', 'date') DEFAULT 'string' COMMENT '参数类型',
    description TEXT COMMENT '参数说明',
    is_system BOOLEAN DEFAULT FALSE COMMENT '是否系统参数',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    updated_by VARCHAR(36),
    
    UNIQUE KEY uk_group_key (setting_group, setting_key),
    INDEX idx_setting_group (setting_group)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统参数表';
```

### 2. 会计核算模块

#### 2.1 科目管理 (已有)
```sql
-- 已有表结构 (02_chart_of_accounts_tables.sql)
-- chart_of_accounts, initial_balances, accounting_periods
```

#### 2.2 凭证管理
```sql
-- 凭证主表
CREATE TABLE vouchers (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    voucher_no VARCHAR(20) NOT NULL COMMENT '凭证号',
    voucher_date DATE NOT NULL COMMENT '凭证日期',
    voucher_type VARCHAR(10) DEFAULT '记' COMMENT '凭证字 (记/收/付/转)',
    fiscal_period VARCHAR(7) NOT NULL COMMENT '会计期间 YYYY-MM',
    attachment_count INT DEFAULT 0 COMMENT '附件数量',
    prepared_by VARCHAR(50) NOT NULL COMMENT '制单人',
    audit_by VARCHAR(50) COMMENT '审核人',
    post_by VARCHAR(50) COMMENT '记账人',
    status ENUM('draft', 'pending', 'approved', 'posted', 'rejected') DEFAULT 'draft' COMMENT '凭证状态',
    remark TEXT COMMENT '凭证备注',
    total_debit DECIMAL(15,2) DEFAULT 0 COMMENT '借方合计',
    total_credit DECIMAL(15,2) DEFAULT 0 COMMENT '贷方合计',
    submit_time DATETIME COMMENT '提交时间',
    audit_time DATETIME COMMENT '审核时间',
    post_time DATETIME COMMENT '记账时间',
    reverse_voucher_id VARCHAR(36) COMMENT '冲销凭证ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    version INT DEFAULT 0,
    
    UNIQUE KEY uk_voucher_period (voucher_no, fiscal_period, voucher_type),
    INDEX idx_voucher_date (voucher_date),
    INDEX idx_fiscal_period (fiscal_period),
    INDEX idx_status (status),
    INDEX idx_prepared_by (prepared_by),
    INDEX idx_audit_by (audit_by),
    FOREIGN KEY (reverse_voucher_id) REFERENCES vouchers(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='凭证主表';

-- 凭证分录表
CREATE TABLE voucher_entries (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    voucher_id VARCHAR(36) NOT NULL COMMENT '凭证ID',
    entry_seq INT NOT NULL COMMENT '分录序号',
    account_id VARCHAR(36) NOT NULL COMMENT '科目ID',
    account_code VARCHAR(20) NOT NULL COMMENT '科目编码',
    account_name VARCHAR(100) NOT NULL COMMENT '科目名称',
    summary VARCHAR(200) COMMENT '摘要',
    debit_amount DECIMAL(15,2) DEFAULT 0 COMMENT '借方金额',
    credit_amount DECIMAL(15,2) DEFAULT 0 COMMENT '贷方金额',
    currency_code VARCHAR(3) DEFAULT 'CNY' COMMENT '币种',
    exchange_rate DECIMAL(10,4) DEFAULT 1.0000 COMMENT '汇率',
    original_amount DECIMAL(15,2) COMMENT '原币金额',
    quantity DECIMAL(15,4) COMMENT '数量',
    unit_price DECIMAL(15,6) COMMENT '单价',
    auxiliary_data JSON COMMENT '辅助核算数据',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    
    INDEX idx_voucher_id (voucher_id),
    INDEX idx_account_id (account_id),
    INDEX idx_account_code (account_code),
    INDEX idx_entry_seq (voucher_id, entry_seq),
    FOREIGN KEY (voucher_id) REFERENCES vouchers(id) ON DELETE CASCADE,
    FOREIGN KEY (account_id) REFERENCES chart_of_accounts(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='凭证分录表';

-- 凭证附件表
CREATE TABLE voucher_attachments (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    voucher_id VARCHAR(36) NOT NULL COMMENT '凭证ID',
    file_name VARCHAR(255) NOT NULL COMMENT '文件名',
    file_path VARCHAR(500) COMMENT '文件路径',
    file_size BIGINT COMMENT '文件大小',
    file_type VARCHAR(50) COMMENT '文件类型',
    uploaded_by VARCHAR(50) COMMENT '上传人',
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_voucher_id (voucher_id),
    FOREIGN KEY (voucher_id) REFERENCES vouchers(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='凭证附件表';

-- 凭证模板表
CREATE TABLE voucher_templates (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    template_name VARCHAR(100) NOT NULL COMMENT '模板名称',
    template_type ENUM('收入', '支出', '转账', '调整') NOT NULL COMMENT '模板类型',
    description TEXT COMMENT '模板描述',
    template_data JSON NOT NULL COMMENT '模板数据',
    is_public BOOLEAN DEFAULT TRUE COMMENT '是否公开',
    usage_count INT DEFAULT 0 COMMENT '使用次数',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_template_type (template_type),
    INDEX idx_created_by (created_by)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='凭证模板表';
```

#### 2.3 账簿管理
```sql
-- 总账表
CREATE TABLE general_ledger (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    account_id VARCHAR(36) NOT NULL COMMENT '科目ID',
    account_code VARCHAR(20) NOT NULL COMMENT '科目编码',
    account_name VARCHAR(100) NOT NULL COMMENT '科目名称',
    fiscal_year INT NOT NULL COMMENT '会计年度',
    fiscal_period INT NOT NULL COMMENT '会计期间',
    beginning_balance DECIMAL(15,2) DEFAULT 0 COMMENT '期初余额',
    period_debit DECIMAL(15,2) DEFAULT 0 COMMENT '本期借方',
    period_credit DECIMAL(15,2) DEFAULT 0 COMMENT '本期贷方',
    ending_balance DECIMAL(15,2) DEFAULT 0 COMMENT '期末余额',
    ytd_debit DECIMAL(15,2) DEFAULT 0 COMMENT '年初至今借方',
    ytd_credit DECIMAL(15,2) DEFAULT 0 COMMENT '年初至今贷方',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_account_period (account_id, fiscal_year, fiscal_period),
    INDEX idx_account_code (account_code),
    INDEX idx_fiscal_period (fiscal_year, fiscal_period),
    FOREIGN KEY (account_id) REFERENCES chart_of_accounts(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='总账表';

-- 明细账表
CREATE TABLE detail_ledger (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    voucher_id VARCHAR(36) NOT NULL COMMENT '凭证ID',
    entry_id VARCHAR(36) NOT NULL COMMENT '分录ID',
    account_id VARCHAR(36) NOT NULL COMMENT '科目ID',
    account_code VARCHAR(20) NOT NULL COMMENT '科目编码',
    voucher_date DATE NOT NULL COMMENT '凭证日期',
    voucher_no VARCHAR(20) NOT NULL COMMENT '凭证号',
    voucher_type VARCHAR(10) NOT NULL COMMENT '凭证字',
    summary VARCHAR(200) COMMENT '摘要',
    debit_amount DECIMAL(15,2) DEFAULT 0 COMMENT '借方金额',
    credit_amount DECIMAL(15,2) DEFAULT 0 COMMENT '贷方金额',
    balance DECIMAL(15,2) DEFAULT 0 COMMENT '余额',
    auxiliary_data JSON COMMENT '辅助核算信息',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_voucher_id (voucher_id),
    INDEX idx_account_id (account_id),
    INDEX idx_account_code (account_code),
    INDEX idx_voucher_date (voucher_date),
    INDEX idx_voucher_no (voucher_no),
    FOREIGN KEY (voucher_id) REFERENCES vouchers(id),
    FOREIGN KEY (entry_id) REFERENCES voucher_entries(id),
    FOREIGN KEY (account_id) REFERENCES chart_of_accounts(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='明细账表';
```

### 3. 现金管理模块

```sql
-- 现金银行账户表
CREATE TABLE cash_bank_accounts (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    account_code VARCHAR(20) UNIQUE NOT NULL COMMENT '账户编码',
    account_name VARCHAR(100) NOT NULL COMMENT '账户名称',
    account_type ENUM('现金', '银行存款', '其他货币资金') NOT NULL COMMENT '账户类型',
    bank_name VARCHAR(100) COMMENT '开户银行',
    account_number VARCHAR(50) COMMENT '账号',
    currency_code VARCHAR(3) DEFAULT 'CNY' COMMENT '币种',
    current_balance DECIMAL(15,2) DEFAULT 0 COMMENT '当前余额',
    account_manager VARCHAR(50) COMMENT '账户管理员',
    status ENUM('启用', '停用') DEFAULT '启用',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_account_code (account_code),
    INDEX idx_account_type (account_type),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='现金银行账户表';

-- 现金日记账表
CREATE TABLE cash_journal (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    account_id VARCHAR(36) NOT NULL COMMENT '账户ID',
    journal_date DATE NOT NULL COMMENT '记账日期',
    voucher_id VARCHAR(36) COMMENT '关联凭证ID',
    voucher_no VARCHAR(20) COMMENT '凭证号',
    summary VARCHAR(200) NOT NULL COMMENT '摘要',
    opposite_account VARCHAR(100) COMMENT '对方科目',
    income_amount DECIMAL(15,2) DEFAULT 0 COMMENT '收入金额',
    expense_amount DECIMAL(15,2) DEFAULT 0 COMMENT '支出金额',
    balance DECIMAL(15,2) NOT NULL COMMENT '余额',
    operator VARCHAR(50) COMMENT '操作员',
    business_type ENUM('收入', '支出') NOT NULL COMMENT '业务类型',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_account_id (account_id),
    INDEX idx_journal_date (journal_date),
    INDEX idx_voucher_id (voucher_id),
    INDEX idx_business_type (business_type),
    FOREIGN KEY (account_id) REFERENCES cash_bank_accounts(id),
    FOREIGN KEY (voucher_id) REFERENCES vouchers(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='现金日记账表';

-- 现金盘点表
CREATE TABLE cash_inventory (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    inventory_no VARCHAR(20) UNIQUE NOT NULL COMMENT '盘点单号',
    account_id VARCHAR(36) NOT NULL COMMENT '现金账户ID',
    inventory_date DATE NOT NULL COMMENT '盘点日期',
    operator VARCHAR(50) NOT NULL COMMENT '盘点人',
    supervisor VARCHAR(50) COMMENT '监盘人',
    book_balance DECIMAL(15,2) NOT NULL COMMENT '账面余额',
    actual_balance DECIMAL(15,2) NOT NULL COMMENT '实际余额',
    difference DECIMAL(15,2) NOT NULL COMMENT '差额',
    status ENUM('draft', 'confirmed', 'processed') DEFAULT 'draft' COMMENT '状态',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    
    INDEX idx_inventory_no (inventory_no),
    INDEX idx_account_id (account_id),
    INDEX idx_inventory_date (inventory_date),
    INDEX idx_status (status),
    FOREIGN KEY (account_id) REFERENCES cash_bank_accounts(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='现金盘点表';

-- 现金盘点明细表
CREATE TABLE cash_inventory_details (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    inventory_id VARCHAR(36) NOT NULL COMMENT '盘点ID',
    denomination VARCHAR(20) NOT NULL COMMENT '面额',
    quantity INT NOT NULL COMMENT '数量',
    amount DECIMAL(15,2) NOT NULL COMMENT '金额',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_inventory_id (inventory_id),
    FOREIGN KEY (inventory_id) REFERENCES cash_inventory(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='现金盘点明细表';

-- 银行对账表
CREATE TABLE bank_reconciliation (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    account_id VARCHAR(36) NOT NULL COMMENT '银行账户ID',
    reconcile_date DATE NOT NULL COMMENT '对账日期',
    statement_balance DECIMAL(15,2) NOT NULL COMMENT '银行对账单余额',
    book_balance DECIMAL(15,2) NOT NULL COMMENT '账面余额',
    reconciled_balance DECIMAL(15,2) NOT NULL COMMENT '调节后余额',
    operator VARCHAR(50) NOT NULL COMMENT '对账人',
    status ENUM('draft', 'completed', 'confirmed') DEFAULT 'draft' COMMENT '对账状态',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    
    INDEX idx_account_id (account_id),
    INDEX idx_reconcile_date (reconcile_date),
    INDEX idx_status (status),
    FOREIGN KEY (account_id) REFERENCES cash_bank_accounts(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='银行对账表';
```

### 4. 往来账款模块

```sql
-- 客户表
CREATE TABLE customers (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    customer_code VARCHAR(20) UNIQUE NOT NULL COMMENT '客户编码',
    customer_name VARCHAR(100) NOT NULL COMMENT '客户名称',
    short_name VARCHAR(50) COMMENT '简称',
    customer_type ENUM('企业', '个人', '政府', '其他') DEFAULT '企业' COMMENT '客户类型',
    tax_number VARCHAR(50) COMMENT '税号',
    legal_person VARCHAR(50) COMMENT '法人代表',
    contact_person VARCHAR(50) COMMENT '联系人',
    phone VARCHAR(20) COMMENT '联系电话',
    mobile VARCHAR(20) COMMENT '手机号',
    email VARCHAR(100) COMMENT '邮箱',
    address TEXT COMMENT '地址',
    postal_code VARCHAR(10) COMMENT '邮编',
    credit_limit DECIMAL(15,2) DEFAULT 0 COMMENT '信用额度',
    payment_terms INT DEFAULT 30 COMMENT '付款期限(天)',
    bank_name VARCHAR(100) COMMENT '开户银行',
    bank_account VARCHAR(50) COMMENT '银行账号',
    salesman VARCHAR(50) COMMENT '业务员',
    industry VARCHAR(50) COMMENT '行业',
    status ENUM('active', 'inactive', 'blacklist') DEFAULT 'active' COMMENT '状态',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_customer_code (customer_code),
    INDEX idx_customer_name (customer_name),
    INDEX idx_contact_person (contact_person),
    INDEX idx_salesman (salesman),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='客户表';

-- 供应商表
CREATE TABLE suppliers (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    supplier_code VARCHAR(20) UNIQUE NOT NULL COMMENT '供应商编码',
    supplier_name VARCHAR(100) NOT NULL COMMENT '供应商名称',
    short_name VARCHAR(50) COMMENT '简称',
    supplier_type ENUM('制造商', '贸易商', '服务商', '其他') DEFAULT '制造商' COMMENT '供应商类型',
    tax_number VARCHAR(50) COMMENT '税号',
    legal_person VARCHAR(50) COMMENT '法人代表',
    contact_person VARCHAR(50) COMMENT '联系人',
    phone VARCHAR(20) COMMENT '联系电话',
    mobile VARCHAR(20) COMMENT '手机号',
    email VARCHAR(100) COMMENT '邮箱',
    address TEXT COMMENT '地址',
    postal_code VARCHAR(10) COMMENT '邮编',
    payment_terms VARCHAR(100) COMMENT '付款条件',
    bank_name VARCHAR(100) COMMENT '开户银行',
    bank_account VARCHAR(50) COMMENT '银行账号',
    purchaser VARCHAR(50) COMMENT '采购员',
    industry VARCHAR(50) COMMENT '行业',
    qualification JSON COMMENT '资质信息',
    rating ENUM('A', 'B', 'C', 'D') COMMENT '供应商等级',
    status ENUM('active', 'inactive', 'blacklist') DEFAULT 'active' COMMENT '状态',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_supplier_code (supplier_code),
    INDEX idx_supplier_name (supplier_name),
    INDEX idx_contact_person (contact_person),
    INDEX idx_purchaser (purchaser),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='供应商表';

-- 销售发票表
CREATE TABLE sales_invoices (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    invoice_no VARCHAR(30) UNIQUE NOT NULL COMMENT '发票号',
    invoice_date DATE NOT NULL COMMENT '开票日期',
    customer_id VARCHAR(36) NOT NULL COMMENT '客户ID',
    customer_name VARCHAR(100) NOT NULL COMMENT '客户名称',
    business_type ENUM('销售', '服务', '其他') DEFAULT '销售' COMMENT '业务类型',
    total_amount DECIMAL(15,2) NOT NULL COMMENT '含税总额',
    tax_amount DECIMAL(15,2) DEFAULT 0 COMMENT '税额',
    net_amount DECIMAL(15,2) NOT NULL COMMENT '不含税金额',
    tax_rate DECIMAL(6,4) DEFAULT 0.13 COMMENT '税率',
    currency_code VARCHAR(3) DEFAULT 'CNY' COMMENT '币种',
    exchange_rate DECIMAL(10,4) DEFAULT 1.0000 COMMENT '汇率',
    received_amount DECIMAL(15,2) DEFAULT 0 COMMENT '已收款金额',
    remaining_amount DECIMAL(15,2) NOT NULL COMMENT '未收款金额',
    due_date DATE COMMENT '到期日期',
    status ENUM('invoiced', 'partial', 'paid', 'overdue', 'cancelled') DEFAULT 'invoiced' COMMENT '发票状态',
    salesman VARCHAR(50) COMMENT '业务员',
    voucher_id VARCHAR(36) COMMENT '关联凭证ID',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_invoice_no (invoice_no),
    INDEX idx_customer_id (customer_id),
    INDEX idx_invoice_date (invoice_date),
    INDEX idx_due_date (due_date),
    INDEX idx_status (status),
    INDEX idx_salesman (salesman),
    FOREIGN KEY (customer_id) REFERENCES customers(id),
    FOREIGN KEY (voucher_id) REFERENCES vouchers(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='销售发票表';

-- 采购发票表  
CREATE TABLE purchase_invoices (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    invoice_no VARCHAR(30) UNIQUE NOT NULL COMMENT '发票号',
    invoice_date DATE NOT NULL COMMENT '开票日期',
    supplier_id VARCHAR(36) NOT NULL COMMENT '供应商ID',
    supplier_name VARCHAR(100) NOT NULL COMMENT '供应商名称',
    business_type ENUM('采购', '服务', '其他') DEFAULT '采购' COMMENT '业务类型',
    total_amount DECIMAL(15,2) NOT NULL COMMENT '含税总额',
    tax_amount DECIMAL(15,2) DEFAULT 0 COMMENT '税额',
    net_amount DECIMAL(15,2) NOT NULL COMMENT '不含税金额',
    tax_rate DECIMAL(6,4) DEFAULT 0.13 COMMENT '税率',
    currency_code VARCHAR(3) DEFAULT 'CNY' COMMENT '币种',
    exchange_rate DECIMAL(10,4) DEFAULT 1.0000 COMMENT '汇率',
    paid_amount DECIMAL(15,2) DEFAULT 0 COMMENT '已付款金额',
    remaining_amount DECIMAL(15,2) NOT NULL COMMENT '未付款金额',
    due_date DATE COMMENT '到期日期',
    status ENUM('confirmed', 'partial', 'paid', 'overdue', 'cancelled') DEFAULT 'confirmed' COMMENT '发票状态',
    purchaser VARCHAR(50) COMMENT '采购员',
    voucher_id VARCHAR(36) COMMENT '关联凭证ID',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_invoice_no (invoice_no),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_invoice_date (invoice_date),
    INDEX idx_due_date (due_date),
    INDEX idx_status (status),
    INDEX idx_purchaser (purchaser),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    FOREIGN KEY (voucher_id) REFERENCES vouchers(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='采购发票表';

-- 收款记录表
CREATE TABLE receivable_payments (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    payment_no VARCHAR(30) UNIQUE NOT NULL COMMENT '收款单号',
    payment_date DATE NOT NULL COMMENT '收款日期',
    customer_id VARCHAR(36) NOT NULL COMMENT '客户ID',
    total_amount DECIMAL(15,2) NOT NULL COMMENT '收款总额',
    payment_method ENUM('转账', '现金', '支票', '电汇', '其他') NOT NULL COMMENT '收款方式',
    bank_account_id VARCHAR(36) COMMENT '收款账户ID',
    operator VARCHAR(50) NOT NULL COMMENT '操作员',
    status ENUM('draft', 'confirmed', 'cancelled') DEFAULT 'confirmed' COMMENT '状态',
    voucher_id VARCHAR(36) COMMENT '关联凭证ID',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    
    INDEX idx_payment_no (payment_no),
    INDEX idx_customer_id (customer_id),
    INDEX idx_payment_date (payment_date),
    INDEX idx_status (status),
    FOREIGN KEY (customer_id) REFERENCES customers(id),
    FOREIGN KEY (bank_account_id) REFERENCES cash_bank_accounts(id),
    FOREIGN KEY (voucher_id) REFERENCES vouchers(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='收款记录表';

-- 收款明细表  
CREATE TABLE receivable_payment_details (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    payment_id VARCHAR(36) NOT NULL COMMENT '收款ID',
    invoice_id VARCHAR(36) NOT NULL COMMENT '发票ID',
    allocated_amount DECIMAL(15,2) NOT NULL COMMENT '核销金额',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_payment_id (payment_id),
    INDEX idx_invoice_id (invoice_id),
    FOREIGN KEY (payment_id) REFERENCES receivable_payments(id) ON DELETE CASCADE,
    FOREIGN KEY (invoice_id) REFERENCES sales_invoices(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='收款明细表';

-- 付款申请表
CREATE TABLE payment_applications (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    application_no VARCHAR(30) UNIQUE NOT NULL COMMENT '申请单号',
    application_date DATE NOT NULL COMMENT '申请日期',
    supplier_id VARCHAR(36) NOT NULL COMMENT '供应商ID',
    supplier_name VARCHAR(100) NOT NULL COMMENT '供应商名称',
    amount DECIMAL(15,2) NOT NULL COMMENT '申请金额',
    payment_method ENUM('转账', '现金', '支票', '汇票', '其他') NOT NULL COMMENT '付款方式',
    planned_pay_date DATE COMMENT '计划付款日期',
    urgency ENUM('普通', '紧急', '特急') DEFAULT '普通' COMMENT '紧急程度',
    applicant VARCHAR(50) NOT NULL COMMENT '申请人',
    applicant_dept VARCHAR(100) COMMENT '申请部门',
    business_reason TEXT NOT NULL COMMENT '申请事由',
    status ENUM('pending', 'approved', 'rejected', 'paid', 'cancelled') DEFAULT 'pending' COMMENT '审批状态',
    approval_level INT DEFAULT 1 COMMENT '当前审批级别',
    current_approver VARCHAR(50) COMMENT '当前审批人',
    audit_by VARCHAR(50) COMMENT '最终审批人',
    audit_time DATETIME COMMENT '审批时间',
    audit_opinion TEXT COMMENT '审批意见',
    payment_voucher_id VARCHAR(36) COMMENT '付款凭证ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    
    INDEX idx_application_no (application_no),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_application_date (application_date),
    INDEX idx_status (status),
    INDEX idx_applicant (applicant),
    INDEX idx_current_approver (current_approver),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    FOREIGN KEY (payment_voucher_id) REFERENCES vouchers(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='付款申请表';

-- 付款申请明细表
CREATE TABLE payment_application_details (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    application_id VARCHAR(36) NOT NULL COMMENT '申请ID',
    invoice_id VARCHAR(36) COMMENT '发票ID',
    invoice_no VARCHAR(30) COMMENT '发票号',
    invoice_amount DECIMAL(15,2) COMMENT '发票金额',
    apply_amount DECIMAL(15,2) NOT NULL COMMENT '申请付款金额',
    remark VARCHAR(200) COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_application_id (application_id),
    INDEX idx_invoice_id (invoice_id),
    FOREIGN KEY (application_id) REFERENCES payment_applications(id) ON DELETE CASCADE,
    FOREIGN KEY (invoice_id) REFERENCES purchase_invoices(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='付款申请明细表';

-- 付款记录表
CREATE TABLE payable_payments (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    payment_no VARCHAR(30) UNIQUE NOT NULL COMMENT '付款单号',
    application_id VARCHAR(36) COMMENT '付款申请ID',
    payment_date DATE NOT NULL COMMENT '付款日期',
    supplier_id VARCHAR(36) NOT NULL COMMENT '供应商ID',
    total_amount DECIMAL(15,2) NOT NULL COMMENT '付款总额',
    payment_method ENUM('转账', '现金', '支票', '汇票', '其他') NOT NULL COMMENT '付款方式',
    bank_account_id VARCHAR(36) COMMENT '付款账户ID',
    operator VARCHAR(50) NOT NULL COMMENT '操作员',
    status ENUM('draft', 'confirmed', 'cancelled') DEFAULT 'confirmed' COMMENT '状态',
    voucher_id VARCHAR(36) COMMENT '关联凭证ID',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    
    INDEX idx_payment_no (payment_no),
    INDEX idx_application_id (application_id),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_payment_date (payment_date),
    INDEX idx_status (status),
    FOREIGN KEY (application_id) REFERENCES payment_applications(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    FOREIGN KEY (bank_account_id) REFERENCES cash_bank_accounts(id),
    FOREIGN KEY (voucher_id) REFERENCES vouchers(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='付款记录表';
```

### 5. 财务报表模块

```sql
-- 报表模板表
CREATE TABLE report_templates (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    template_code VARCHAR(20) UNIQUE NOT NULL COMMENT '模板编码',
    template_name VARCHAR(100) NOT NULL COMMENT '模板名称',
    report_type ENUM('balance_sheet', 'income_statement', 'cash_flow', 'custom') NOT NULL COMMENT '报表类型',
    template_config JSON NOT NULL COMMENT '模板配置',
    is_default BOOLEAN DEFAULT FALSE COMMENT '是否默认模板',
    is_system BOOLEAN DEFAULT FALSE COMMENT '是否系统模板',
    status ENUM('启用', '停用') DEFAULT '启用',
    description TEXT COMMENT '模板说明',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(36),
    updated_by VARCHAR(36),
    deleted BOOLEAN DEFAULT FALSE,
    
    INDEX idx_template_code (template_code),
    INDEX idx_report_type (report_type),
    INDEX idx_is_default (is_default)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='报表模板表';

-- 报表项目配置表
CREATE TABLE report_items (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    template_id VARCHAR(36) NOT NULL COMMENT '模板ID',
    item_code VARCHAR(20) NOT NULL COMMENT '项目编码',
    item_name VARCHAR(100) NOT NULL COMMENT '项目名称',
    item_level INT NOT NULL DEFAULT 1 COMMENT '项目层级',
    parent_code VARCHAR(20) COMMENT '父项目编码',
    account_codes TEXT COMMENT '对应科目编码(JSON)',
    formula TEXT COMMENT '计算公式',
    sort_order INT DEFAULT 0 COMMENT '排序',
    is_summary BOOLEAN DEFAULT FALSE COMMENT '是否合计项',
    is_bold BOOLEAN DEFAULT FALSE COMMENT '是否加粗显示',
    is_indent BOOLEAN DEFAULT FALSE COMMENT '是否缩进显示',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_template_id (template_id),
    INDEX idx_item_code (item_code),
    INDEX idx_parent_code (parent_code),
    INDEX idx_sort_order (sort_order),
    FOREIGN KEY (template_id) REFERENCES report_templates(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='报表项目配置表';

-- 报表生成记录表
CREATE TABLE report_generation_log (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    template_id VARCHAR(36) NOT NULL COMMENT '模板ID',
    report_title VARCHAR(200) NOT NULL COMMENT '报表标题',
    report_period VARCHAR(20) NOT NULL COMMENT '报告期间',
    start_date DATE COMMENT '开始日期',
    end_date DATE COMMENT '结束日期',
    report_data JSON COMMENT '报表数据',
    generation_params JSON COMMENT '生成参数',
    generated_by VARCHAR(50) NOT NULL COMMENT '生成人',
    generated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    file_path VARCHAR(500) COMMENT '文件路径',
    file_format ENUM('PDF', 'Excel', 'HTML') COMMENT '文件格式',
    
    INDEX idx_template_id (template_id),
    INDEX idx_report_period (report_period),
    INDEX idx_generated_by (generated_by),
    INDEX idx_generated_at (generated_at),
    FOREIGN KEY (template_id) REFERENCES report_templates(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='报表生成记录表';
```

### 6. 系统日志模块

```sql
-- 系统操作日志表
CREATE TABLE system_logs (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) COMMENT '用户ID',
    username VARCHAR(50) COMMENT '用户名',
    module VARCHAR(50) NOT NULL COMMENT '模块名称',
    operation VARCHAR(100) NOT NULL COMMENT '操作名称',
    operation_type ENUM('CREATE', 'UPDATE', 'DELETE', 'QUERY', 'EXPORT', 'IMPORT', 'LOGIN', 'LOGOUT') NOT NULL COMMENT '操作类型',
    business_id VARCHAR(36) COMMENT '业务ID',
    description TEXT COMMENT '操作描述',
    ip_address VARCHAR(45) COMMENT 'IP地址',
    user_agent TEXT COMMENT 'User Agent',
    request_url VARCHAR(500) COMMENT '请求URL',
    request_method VARCHAR(10) COMMENT '请求方法',
    request_params TEXT COMMENT '请求参数',
    response_status INT COMMENT '响应状态码',
    execution_time BIGINT COMMENT '执行时间(毫秒)',
    error_message TEXT COMMENT '错误信息',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_username (username),
    INDEX idx_module (module),
    INDEX idx_operation_type (operation_type),
    INDEX idx_business_id (business_id),
    INDEX idx_created_at (created_at),
    INDEX idx_ip_address (ip_address),
    FOREIGN KEY (user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统操作日志表';

-- 数据审计记录表
CREATE TABLE audit_trails (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    table_name VARCHAR(100) NOT NULL COMMENT '表名',
    record_id VARCHAR(36) NOT NULL COMMENT '记录ID',
    operation ENUM('INSERT', 'UPDATE', 'DELETE') NOT NULL COMMENT '操作类型',
    old_values JSON COMMENT '修改前数据',
    new_values JSON COMMENT '修改后数据',
    changed_fields TEXT COMMENT '变更字段列表',
    user_id VARCHAR(36) COMMENT '操作用户ID',
    username VARCHAR(50) COMMENT '操作用户名',
    ip_address VARCHAR(45) COMMENT 'IP地址',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_table_record (table_name, record_id),
    INDEX idx_user_id (user_id),
    INDEX idx_username (username),
    INDEX idx_operation (operation),
    INDEX idx_created_at (created_at),
    FOREIGN KEY (user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='数据审计记录表';

-- 登录日志表
CREATE TABLE login_logs (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    login_type ENUM('WEB', 'MOBILE', 'API') DEFAULT 'WEB' COMMENT '登录类型',
    login_status ENUM('SUCCESS', 'FAILED', 'LOGOUT') NOT NULL COMMENT '登录状态',
    ip_address VARCHAR(45) COMMENT 'IP地址',
    location VARCHAR(200) COMMENT '登录地点',
    user_agent TEXT COMMENT 'User Agent',
    failure_reason VARCHAR(200) COMMENT '失败原因',
    session_id VARCHAR(100) COMMENT '会话ID',
    login_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '登录时间',
    logout_time TIMESTAMP COMMENT '登出时间',
    session_duration BIGINT COMMENT '会话时长(秒)',
    
    INDEX idx_username (username),
    INDEX idx_login_status (login_status),
    INDEX idx_login_time (login_time),
    INDEX idx_ip_address (ip_address),
    INDEX idx_session_id (session_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='登录日志表';

-- 数据备份记录表
CREATE TABLE backup_records (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    backup_no VARCHAR(30) UNIQUE NOT NULL COMMENT '备份编号',
    backup_type ENUM('FULL', 'INCREMENTAL', 'DIFFERENTIAL') NOT NULL COMMENT '备份类型',
    backup_mode ENUM('MANUAL', 'AUTO', 'SCHEDULED') DEFAULT 'MANUAL' COMMENT '备份模式',
    backup_filename VARCHAR(255) NOT NULL COMMENT '备份文件名',
    backup_path VARCHAR(500) COMMENT '备份路径',
    file_size BIGINT COMMENT '文件大小(字节)',
    backup_status ENUM('RUNNING', 'SUCCESS', 'FAILED', 'CANCELLED') DEFAULT 'RUNNING' COMMENT '备份状态',
    start_time DATETIME NOT NULL COMMENT '开始时间',
    end_time DATETIME COMMENT '结束时间',
    duration BIGINT COMMENT '耗时(秒)',
    operator VARCHAR(50) NOT NULL COMMENT '操作人',
    error_message TEXT COMMENT '错误信息',
    description TEXT COMMENT '备份说明',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_backup_no (backup_no),
    INDEX idx_backup_type (backup_type),
    INDEX idx_backup_status (backup_status),
    INDEX idx_start_time (start_time),
    INDEX idx_operator (operator)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='数据备份记录表';
```

---

## 📋 数据库初始化脚本

### 基础数据初始化
```sql
-- 1. 初始化币种数据
INSERT INTO currencies (currency_code, currency_name, currency_symbol, is_base) VALUES
('CNY', '人民币', '¥', TRUE),
('USD', '美元', '$', FALSE),
('EUR', '欧元', '€', FALSE),
('JPY', '日元', '¥', FALSE),
('GBP', '英镑', '£', FALSE);

-- 2. 初始化系统参数
INSERT INTO system_settings (setting_group, setting_key, setting_value, setting_type, description) VALUES
('company', 'company_name', '示例公司', 'string', '公司名称'),
('company', 'company_code', '001', 'string', '公司编码'),
('company', 'tax_number', '91000000000000000X', 'string', '纳税人识别号'),
('company', 'legal_person', '张三', 'string', '法定代表人'),
('company', 'address', '北京市朝阳区', 'string', '公司地址'),
('company', 'phone', '010-12345678', 'string', '公司电话'),
('accounting', 'fiscal_year_start', '01-01', 'string', '会计年度开始日期'),
('accounting', 'currency_code', 'CNY', 'string', '本位币'),
('accounting', 'decimal_places', '2', 'number', '金额小数位数'),
('voucher', 'auto_numbering', 'true', 'boolean', '凭证自动编号'),
('voucher', 'check_balance', 'true', 'boolean', '凭证借贷平衡检查'),
('system', 'backup_retention_days', '30', 'number', '备份保留天数'),
('system', 'log_retention_days', '90', 'number', '日志保留天数');

-- 3. 初始化现金银行账户
INSERT INTO cash_bank_accounts (account_code, account_name, account_type, current_balance) VALUES
('CASH01', '库存现金-人民币', '现金', 0),
('BANK01', '中国银行-基本户', '银行存款', 0),
('BANK02', '工商银行-一般户', '银行存款', 0);

-- 4. 初始化部门数据
INSERT INTO departments (dept_code, dept_name, dept_type, level) VALUES
('001', '总经理办公室', '部门', 1),
('002', '财务部', '部门', 1),
('003', '销售部', '部门', 1),
('004', '采购部', '部门', 1),
('005', '人事部', '部门', 1);

-- 5. 初始化报表模板
INSERT INTO report_templates (template_code, template_name, report_type, template_config, is_default, is_system) VALUES
('BS001', '资产负债表', 'balance_sheet', '{}', TRUE, TRUE),
('IS001', '利润表', 'income_statement', '{}', TRUE, TRUE),
('CF001', '现金流量表', 'cash_flow', '{}', TRUE, TRUE);
```

---

## 🔍 索引优化策略

### 关键业务索引
```sql
-- 凭证查询优化索引
CREATE INDEX idx_voucher_date_status ON vouchers(voucher_date, status);
CREATE INDEX idx_voucher_period_type ON vouchers(fiscal_period, voucher_type);
CREATE INDEX idx_entry_account_date ON voucher_entries(account_code, voucher_date);

-- 往来账款优化索引
CREATE INDEX idx_sales_customer_status ON sales_invoices(customer_id, status);
CREATE INDEX idx_purchase_supplier_status ON purchase_invoices(supplier_id, status);
CREATE INDEX idx_receivable_due_status ON sales_invoices(due_date, status);
CREATE INDEX idx_payable_due_status ON purchase_invoices(due_date, status);

-- 现金管理优化索引
CREATE INDEX idx_cash_account_date ON cash_journal(account_id, journal_date);
CREATE INDEX idx_bank_reconcile_account_date ON bank_reconciliation(account_id, reconcile_date);

-- 日志查询优化索引
CREATE INDEX idx_system_log_user_time ON system_logs(user_id, created_at);
CREATE INDEX idx_audit_table_time ON audit_trails(table_name, created_at);
CREATE INDEX idx_login_user_time ON login_logs(username, login_time);

-- 复合业务索引
CREATE INDEX idx_ledger_account_period ON general_ledger(account_code, fiscal_year, fiscal_period);
CREATE INDEX idx_detail_account_date ON detail_ledger(account_code, voucher_date);
```

---

## 📊 统计信息

### 数据库表统计
- **基础设置模块**: 12个表
- **会计核算模块**: 11个表  
- **现金管理模块**: 6个表
- **往来账款模块**: 12个表
- **财务报表模块**: 3个表
- **系统日志模块**: 4个表

**总计**: 48个核心业务表

### 功能覆盖率
- ✅ 用户权限管理: 100%
- ✅ 组织架构管理: 100%
- ✅ 科目期初管理: 100%
- ✅ 凭证全流程: 100%
- ✅ 现金银行管理: 100%
- ✅ 往来账款管理: 100%
- ✅ 财务报表: 100%
- ✅ 系统日志审计: 100%

---

## 🔒 数据安全与完整性

### 外键约束
- 所有关联关系都设置了外键约束
- 重要业务数据设置级联删除保护
- 关键字段设置唯一性约束

### 审计跟踪
- 所有业务表包含完整审计字段
- 系统操作日志记录所有用户行为
- 数据变更审计记录所有关键数据修改

### 数据备份
- 备份记录表追踪所有备份操作
- 支持多种备份类型和模式
- 完整的备份状态监控

---

**设计完成时间**: 2025-08-20  
**适用系统**: 内部财务管理系统  
**数据库版本**: MySQL 8.0+  
**字符集**: UTF8MB4