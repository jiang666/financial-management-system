# 前后端连接指南

## 🎯 连接状态

### ✅ 已完成配置

1. **后端CORS配置** ✅
   - 已在SecurityConfig中配置跨域支持
   - 允许localhost:3000等前端域名访问
   - 支持所有必要的HTTP方法和请求头

2. **前端API配置** ✅
   - 创建了完整的API配置文件
   - 实现了axios请求拦截器和响应拦截器
   - 配置了Vite开发服务器代理

3. **认证集成** ✅
   - 更新了Vuex store以支持真实API
   - 实现了token自动管理
   - 配置了权限检查机制

## 🚀 启动步骤

### 1. 启动后端服务
```bash
# 在 backend 目录下
cd D:\code\financial-management-system\backend
mvn spring-boot:run
```
后端将运行在: http://localhost:8080/api

### 2. 启动前端服务
```bash
# 在 frontend 目录下
cd D:\code\financial-management-system\frontend
npm install  # 如果还没有安装依赖
npm run dev
```
前端将运行在: http://localhost:3000

### 3. 测试连接
访问 http://localhost:3000，使用以下账号登录：
- **用户名**: admin
- **密码**: admin123

## 📋 API集成状态

### ✅ 已集成的功能
- 🔐 **用户认证**
  - 登录/登出
  - 获取当前用户信息
  - 密码修改
  - Token自动管理

- 👥 **用户管理**
  - 用户列表查询
  - 用户创建/更新/删除
  - 用户详情查询

- 📊 **科目管理**
  - 科目列表查询
  - 科目树结构获取
  - 科目创建/更新/删除

### 🛠️ 技术特性
- **自动Token管理**: 登录后自动保存token，请求时自动添加
- **请求拦截**: 自动添加认证头，处理请求/响应日志
- **错误处理**: 统一的错误消息提示，401自动跳转登录
- **CORS支持**: 完全配置的跨域访问
- **开发代理**: Vite代理避免开发环境跨域问题

## 🔧 开发环境配置

### Vite代理配置
```javascript
server: {
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true,
      secure: false
    }
  }
}
```

### API请求示例
```javascript
// 登录
import { authAPI } from '@/api'

const login = async () => {
  try {
    const response = await authAPI.login({
      username: 'admin',
      password: 'admin123'
    })
    console.log('登录成功:', response)
  } catch (error) {
    console.error('登录失败:', error)
  }
}
```

## 🐛 常见问题解决

### Q1: 前端显示网络错误
**解决方案**:
1. 确认后端服务是否启动 (http://localhost:8080/api/health/check)
2. 检查CORS配置是否正确
3. 查看浏览器开发者工具的Network面板

### Q2: 401认证失败
**解决方案**:
1. 检查用户名密码是否正确
2. 确认token是否正确保存
3. 检查请求头是否包含Authorization

### Q3: 跨域问题
**解决方案**:
1. 开发环境: 确保Vite代理配置正确
2. 生产环境: 确保后端CORS配置包含前端域名
3. 检查preflight请求是否正常

## 📊 API文档

### 认证接口
- `POST /api/auth/login` - 用户登录
- `GET /api/auth/me` - 获取当前用户信息
- `POST /api/auth/logout` - 用户登出

### 用户管理
- `GET /api/users` - 获取用户列表
- `POST /api/users` - 创建用户
- `PUT /api/users/{id}` - 更新用户

### 科目管理
- `GET /api/accounts` - 获取科目列表
- `GET /api/accounts/tree` - 获取科目树
- `POST /api/accounts` - 创建科目

## 🧪 测试建议

### 1. 基础连接测试
1. 启动前后端服务
2. 访问前端登录页面
3. 使用默认账号登录
4. 检查浏览器Network面板的API请求

### 2. 功能模块测试
1. 登录后访问各个功能模块
2. 测试数据的增删改查操作
3. 验证权限控制是否生效

### 3. 错误处理测试
1. 故意输入错误的用户名密码
2. 在token过期时测试自动登出
3. 测试网络断开的错误提示

## 📈 下一步开发

1. **完善页面功能**: 逐步替换mock数据为真实API调用
2. **权限集成**: 在前端实现基于后端权限的功能控制
3. **数据校验**: 前后端数据校验规则统一
4. **错误处理**: 完善各种异常情况的用户体验

---

**更新时间**: 2025-08-20 12:30