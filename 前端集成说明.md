# 系统参数前端集成说明

## 已完成的工作

### 1. API服务文件
已创建 `/frontend/src/api/system-params.js`，包含所有系统参数相关的API调用方法。

### 2. 页面集成
已修改 `/frontend/src/views/settings/system/index.vue`，实现了：

- **自动加载数据**：页面加载时自动从后端获取所有系统参数
- **数据映射**：将后端参数自动映射到前端表单
- **保存功能**：所有保存按钮都会调用后端API保存数据
- **错误处理**：API调用失败时显示友好提示并使用默认值
- **加载状态**：显示加载动画提升用户体验

### 3. 保持的功能和样式
- ✅ 页面布局完全不变
- ✅ 所有样式保持原样
- ✅ 表单交互功能正常
- ✅ 提示消息正常显示
- ✅ 所有原有功能都保留

## 使用说明

### 1. 启动后端服务
```bash
# 在后端目录
cd backend
mvn spring-boot:run
```

### 2. 启动前端服务
```bash
# 在前端目录
cd frontend
npm run dev
```

### 3. 访问系统
- 访问 http://localhost:5173
- 使用 admin/admin123 登录
- 进入"设置 -> 系统参数"页面

### 4. 功能测试
- 页面会自动加载数据库中的参数值
- 修改任意设置后点击保存按钮
- 查看是否有成功提示
- 刷新页面验证数据是否保存

## API调用流程

### 加载数据流程
1. 页面加载时调用 `loadAllParameters()`
2. 调用 API 获取所有参数（最多100个）
3. 创建参数映射表 `paramMap`
4. 调用 `mapParamsToForms()` 将数据映射到各个表单

### 保存数据流程
1. 用户点击保存按钮
2. 收集表单数据并转换为后端格式
3. 调用 `systemParamApi.batchUpdate()` 批量更新
4. 显示成功或失败提示

## 参数映射关系

### 基本设置
- 公司名称: `company.name`
- 纳税人识别号: `company.tax_number`
- 法人代表: `company.legal_person`
- 注册地址: `company.address`
- 联系电话: `company.phone`
- 电子邮箱: `company.email`

### 会计期间设置
- 会计年度: `period.fiscal_year`
- 启用期间: `period.start_period`
- 当前期间: `period.current_period`
- 是否按期结账: `period.is_period_close`
- 自动结转损益: `period.auto_carry_forward`

### 凭证设置
- 凭证编号规则: `voucher.number_rule`
- 编号位数: `voucher.number_length`
- 审核后允许修改: `voucher.allow_edit_after_audit`
- 凭证类型: `voucher.types`

### 权限控制
- 制单人可修改: `permission.creator_can_edit`
- 审核人可修改: `permission.auditor_can_edit`
- 记账人可修改: `permission.bookkeeper_can_edit`
- 跨期间查询: `permission.cross_period_query`
- 数据导出权限: `permission.export_roles`
- 登录失败锁定: `login.lock_enabled`
- 失败次数限制: `login.max_attempts`

### 备份设置
- 自动备份: `backup.auto_enable`
- 备份频率: `backup.frequency`
- 备份时间: `backup.schedule`
- 保留天数: `backup.retention_days`

## 注意事项

1. **后端服务必须启动**：确保后端服务在8086端口正常运行
2. **数据库初始化**：确保数据库中有系统参数表和初始数据
3. **权限配置**：当前已临时禁用权限检查，生产环境需要恢复
4. **错误处理**：如果API调用失败，页面会显示默认值

## 测试方法

运行自动化测试：
```bash
cd frontend
npm install puppeteer  # 如果未安装
node test-system-params-integration.mjs
```

手动测试：
1. 修改任意设置
2. 点击对应的保存按钮
3. 查看提示消息
4. 刷新页面验证数据