# 系统参数前后端映射文档

## 概述
本文档详细说明了前端页面表单字段与后端系统参数的映射关系，确保前后端数据一致性。

## 1. 基本设置 (basicForm)

| 前端字段 | 后端参数键 | 参数类型 | 说明 | 数据库已初始化 |
|---------|-----------|---------|------|--------------|
| basicForm.companyName | company.name | STRING | 公司名称 | ✅ |
| basicForm.taxNumber | company.tax_number | STRING | 纳税人识别号 | ✅ |
| basicForm.legalPerson | company.legal_person | STRING | 法人代表 | ✅ |
| basicForm.address | company.address | STRING | 注册地址 | ✅ |
| basicForm.phone | company.phone | STRING | 联系电话 | ✅ |
| basicForm.email | company.email | STRING | 电子邮箱 | ✅ (V9新增) |

## 2. 会计期间设置 (periodForm)

| 前端字段 | 后端参数键 | 参数类型 | 说明 | 数据库已初始化 |
|---------|-----------|---------|------|--------------|
| periodForm.fiscalYear | period.fiscal_year | STRING | 会计年度 (格式: YYYY) | ✅ (V9新增) |
| periodForm.startPeriod | period.start_period | STRING | 启用期间 (格式: YYYY-MM) | ✅ (V9新增) |
| periodForm.currentPeriod | period.current_period | STRING | 当前期间 (格式: YYYY-MM) | ✅ (V9新增) |
| periodForm.isPeriodClose | period.is_period_close | BOOLEAN | 是否按期结账 | ✅ (V9新增) |
| periodForm.autoCarryForward | period.auto_carry_forward | BOOLEAN | 自动结转损益 | ✅ (V9新增) |

## 3. 凭证设置 (voucherForm)

| 前端字段 | 后端参数键 | 参数类型 | 说明 | 数据库已初始化 |
|---------|-----------|---------|------|--------------|
| voucherForm.numberRule | voucher.number_rule | ENUM | 凭证编号规则 | ✅ |
| | | | 可选值: YEARLY(yearly), MONTHLY(monthly), CONTINUOUS(continuous) | |
| voucherForm.numberLength | voucher.number_length | INTEGER | 编号位数 (3-8) | ✅ (V9新增) |
| voucherForm.allowEditAfterAudit | voucher.allow_edit_after_audit | BOOLEAN | 审核后允许修改 | ✅ (V9新增) |
| voucherTypes | voucher.types | JSON | 凭证字设置 | ✅ (V9新增) |

### 凭证字类型数据格式
```json
[
  {"code":"记","name":"记账凭证","enabled":true},
  {"code":"收","name":"收款凭证","enabled":true},
  {"code":"付","name":"付款凭证","enabled":true},
  {"code":"转","name":"转账凭证","enabled":false}
]
```

## 4. 权限控制 (permissionForm)

| 前端字段 | 后端参数键 | 参数类型 | 说明 | 数据库已初始化 |
|---------|-----------|---------|------|--------------|
| permissionForm.creatorCanEdit | permission.creator_can_edit | BOOLEAN | 制单人可修改 | ✅ (V9新增) |
| permissionForm.auditorCanEdit | permission.auditor_can_edit | BOOLEAN | 审核人可修改 | ✅ (V9新增) |
| permissionForm.bookkeeperCanEdit | permission.bookkeeper_can_edit | BOOLEAN | 记账人可修改 | ✅ (V9新增) |
| permissionForm.crossPeriodQuery | permission.cross_period_query | BOOLEAN | 跨期间查询 | ✅ (V9新增) |
| permissionForm.exportRoles | permission.export_roles | JSON | 数据导出权限 | ✅ (V9新增) |
| permissionForm.loginLock | login.lock_enabled | BOOLEAN | 登录失败锁定 | ✅ (V9新增) |
| permissionForm.maxFailAttempts | login.max_attempts | INTEGER | 失败次数限制 | ✅ |

### 导出权限数据格式
```json
["admin", "finance", "accountant"]
```

## 5. 数据备份设置 (backupForm)

| 前端字段 | 后端参数键 | 参数类型 | 说明 | 数据库已初始化 |
|---------|-----------|---------|------|--------------|
| backupForm.autoBackup | backup.auto_enable | BOOLEAN | 自动备份 | ✅ |
| backupForm.frequency | backup.frequency | ENUM | 备份频率 | ✅ (V9新增) |
| | | | 可选值: daily, weekly, monthly | |
| backupForm.backupTime | backup.schedule | TIME | 备份时间 (HH:mm) | ✅ |
| backupForm.retentionDays | backup.retention_days | INTEGER | 保留天数 (7-365) | ✅ |

## 6. 其他已初始化但前端未使用的参数

### 会计制度
- accounting.standard - 会计准则 (ENTERPRISE/SMALL_ENTERPRISE)
- accounting.currency - 记账本位币 (CNY)
- accounting.start_date - 账套启用日期
- accounting.fiscal_year_start - 会计年度起始月

### 科目设置
- account.code_rule - 科目编码规则 (4-2-2-2)
- account.max_level - 科目最大级次
- account.allow_auxiliary - 启用辅助核算

### 安全设置
- password.min_length - 密码最小长度
- password.expire_days - 密码有效期
- password.complexity - 密码复杂度要求
- login.lock_duration - 账户锁定时长
- session.timeout - 会话超时时间

### 日志设置
- log.level - 日志级别
- log.retention_days - 日志保留天数
- log.archive_enable - 启用日志归档

### 报表参数
- report.export_format - 默认导出格式
- report.watermark_enable - 启用水印
- report.watermark_text - 水印文字

## 使用示例

### 1. 加载参数
```javascript
// 加载所有参数
const res = await systemParamApi.getParameters()

// 按分类加载
const basicParams = await systemParamApi.getParameters({ category: 'BASIC' })
const financialParams = await systemParamApi.getParameters({ category: 'FINANCIAL' })
```

### 2. 批量更新参数
```javascript
const updates = [
  { paramKey: 'company.name', paramValue: this.basicForm.companyName },
  { paramKey: 'company.tax_number', paramValue: this.basicForm.taxNumber }
]
await systemParamApi.batchUpdate(updates)
```

### 3. 处理布尔值
```javascript
// 从后端获取时转换
const value = param.paramValue === 'true'

// 保存到后端时转换
const paramValue = booleanValue.toString()
```

### 4. 处理JSON数据
```javascript
// 从后端获取时解析
const voucherTypes = JSON.parse(param.paramValue)

// 保存到后端时序列化
const paramValue = JSON.stringify(voucherTypes)
```

## 注意事项

1. **类型转换**：后端存储的参数值都是字符串，前端需要根据param_type进行相应的类型转换
2. **日期格式**：日期使用 YYYY-MM-DD 格式，月份使用 YYYY-MM 格式
3. **权限控制**：系统参数(is_system=true)只有超级管理员可以修改
4. **缓存刷新**：修改参数后，某些参数可能需要刷新缓存才能生效
5. **重启要求**：某些参数(restart_required=true)修改后需要重启系统才能生效

## 备份历史管理

备份历史数据存储在 `backup_history` 表中，可以通过以下方式管理：

1. **获取备份历史**：需要单独的API接口（待实现）
2. **手动备份**：需要单独的API接口（待实现）
3. **下载备份**：需要单独的API接口（待实现）
4. **删除备份**：需要单独的API接口（待实现）

这些功能不属于系统参数管理，需要独立的备份管理模块。