# æ•°æ®åº“è®¾è®¡çº¦æŸæç¤ºè¯

## ğŸ—„ï¸ æ•°æ®åº“é€‰å‹çº¦æŸ

### ä¸‰ç§æ•°æ®åº“çš„ä½¿ç”¨åœºæ™¯

```
ä»…å…è®¸ä½¿ç”¨ä»¥ä¸‹ä¸‰ç§æ•°æ®åº“ï¼Œä¸¥æ ¼æŒ‰åœºæ™¯åˆ’åˆ†ï¼š

## MySQL (å…³ç³»å‹ - ä¸»è¦ä¸šåŠ¡æ•°æ®)
âœ… ç”¨æˆ·ç®¡ç†ã€è§’è‰²æƒé™
âœ… ä¸šåŠ¡æ ¸å¿ƒæ•°æ® (è®¢å•ã€äº§å“ç­‰)
âœ… é…ç½®ä¿¡æ¯ã€ç³»ç»Ÿè®¾ç½®
âœ… éœ€è¦äº‹åŠ¡ä¿è¯çš„æ•°æ®
âœ… å…³ç³»å¤æ‚çš„ç»“æ„åŒ–æ•°æ®

## MongoDB (æ–‡æ¡£å‹ - çµæ´»æ•°æ®)
âœ… ç³»ç»Ÿæ—¥å¿—ã€æ“ä½œè®°å½•
âœ… æ–‡æ¡£å­˜å‚¨ã€å†…å®¹ç®¡ç†
âœ… éç»“æ„åŒ–æ•°æ®
âœ… å¿«é€Ÿè¯»å†™çš„ç¼“å­˜æ•°æ®
âœ… æ•°æ®ç»“æ„ç»å¸¸å˜åŒ–çš„åœºæ™¯

## PostgreSQL (å…³ç³»å‹ + å‘é‡ - AIæ•°æ®)
âœ… AIå‘é‡å­˜å‚¨ (pgvectoræ‰©å±•)
âœ… æ–‡æ¡£åµŒå…¥å‘é‡ã€è¯­ä¹‰æœç´¢
âœ… æœºå™¨å­¦ä¹ ç‰¹å¾æ•°æ®
âœ… å¤æ‚æŸ¥è¯¢å’Œåˆ†æ
âœ… éœ€è¦å‘é‡ç›¸ä¼¼åº¦è®¡ç®—çš„åœºæ™¯
```

------

## ğŸ“‹ MySQLè®¾è®¡çº¦æŸ

### è¡¨ç»“æ„è§„èŒƒ

```sql
-- å¿…é¡»éµå®ˆçš„è¡¨ç»“æ„è§„èŒƒ
CREATE TABLE table_name (
    -- 1. ä¸»é”®å¿…é¡»ä¸ºUUIDç±»å‹
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    
    -- 2. å¿…é¡»æœ‰åˆ›å»ºå’Œæ›´æ–°æ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- 3. é€»è¾‘åˆ é™¤å­—æ®µ (æ¨è)
    deleted BOOLEAN DEFAULT FALSE,
    
    -- 4. ç‰ˆæœ¬æ§åˆ¶å­—æ®µ (ä¹è§‚é”)
    version INT DEFAULT 0,
    
    -- ä¸šåŠ¡å­—æ®µ...
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    
    -- 5. ç´¢å¼•è§„èŒƒ
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_created_at (created_at)
);
```

### å‘½åè§„èŒƒ

```
è¡¨åï¼šsnake_caseï¼Œå¤æ•°å½¢å¼ (users, user_roles, order_items)
å­—æ®µåï¼šsnake_case (user_name, created_at, is_active)
ç´¢å¼•åï¼šidx_å­—æ®µå (idx_username, idx_created_at)
å¤–é”®åï¼šfk_è¡¨å_å­—æ®µå (fk_users_role_id)
```

### å­—æ®µç±»å‹çº¦æŸ

```sql
-- å­—ç¬¦ä¸²ç±»å‹
VARCHAR(50)     -- çŸ­æ–‡æœ¬ (ç”¨æˆ·åã€çŠ¶æ€ç­‰)
VARCHAR(255)    -- ä¸­ç­‰æ–‡æœ¬ (é‚®ç®±ã€åœ°å€ç­‰)
TEXT           -- é•¿æ–‡æœ¬ (æè¿°ã€å†…å®¹ç­‰)

-- æ•°å€¼ç±»å‹
TINYINT        -- å¸ƒå°”å€¼ã€çŠ¶æ€ç 
INT            -- è®¡æ•°ã€æ•°é‡
BIGINT         -- å¤§æ•°å€¼ã€æ—¶é—´æˆ³
DECIMAL(10,2)  -- é‡‘é¢ã€ç²¾ç¡®å°æ•°

-- æ—¶é—´ç±»å‹
TIMESTAMP      -- åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´
DATE           -- æ—¥æœŸ
TIME           -- æ—¶é—´
```

------

## ğŸ“„ MongoDBè®¾è®¡çº¦æŸ

### æ–‡æ¡£ç»“æ„è§„èŒƒ

```javascript
// ç³»ç»Ÿæ—¥å¿—æ–‡æ¡£ç»“æ„
{
  "_id": ObjectId(), // MongoDBè‡ªåŠ¨ç”Ÿæˆ
  "level": "INFO",   // æ—¥å¿—çº§åˆ«
  "message": "ç”¨æˆ·ç™»å½•æˆåŠŸ",
  "module": "auth",  // æ¨¡å—åç§°
  "userId": "uuid-string", // å…³è”çš„MySQLç”¨æˆ·ID
  "timestamp": ISODate("2025-01-15T10:30:00Z"),
  "details": {       // åµŒå¥—æ–‡æ¡£
    "ip": "192.168.1.1",
    "userAgent": "Mozilla/5.0...",
    "action": "login"
  },
  "tags": ["auth", "success"], // æ•°ç»„å­—æ®µ
  "metadata": {}     // åŠ¨æ€å­—æ®µ
}

// å†…å®¹æ–‡æ¡£ç»“æ„  
{
  "_id": ObjectId(),
  "title": "æ–‡æ¡£æ ‡é¢˜",
  "content": "æ–‡æ¡£å†…å®¹...", 
  "type": "article",
  "author": {        // åµŒå¥—å¯¹è±¡
    "id": "uuid-string",
    "name": "ä½œè€…å"
  },
  "categories": ["tech", "ai"], // åˆ†ç±»æ•°ç»„
  "status": "published",
  "createdAt": ISODate(),
  "updatedAt": ISODate(),
  "version": 1
}
```

### é›†åˆå‘½åè§„èŒƒ

```
é›†åˆåï¼šsnake_caseï¼Œå¤æ•°å½¢å¼
system_logs, user_activities, content_documents
document_templates, ai_chat_histories
```

### ç´¢å¼•ç­–ç•¥

```javascript
// å¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•
db.system_logs.createIndex({ "level": 1, "timestamp": -1 })
db.system_logs.createIndex({ "userId": 1 })
db.system_logs.createIndex({ "module": 1, "timestamp": -1 })

// å¤åˆç´¢å¼•
db.content_documents.createIndex({ "type": 1, "status": 1, "createdAt": -1 })

// æ–‡æœ¬æœç´¢ç´¢å¼•
db.content_documents.createIndex({ "title": "text", "content": "text" })
```

------

## ğŸ¤– PostgreSQLè®¾è®¡çº¦æŸ

### å‘é‡è¡¨ç»“æ„è§„èŒƒ

```sql
-- å¿…é¡»å®‰è£…pgvectoræ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

-- AIå‘é‡å­˜å‚¨è¡¨
CREATE TABLE document_embeddings (
    -- 1. ä¸»é”®UUID
    id VARCHAR(36) PRIMARY KEY DEFAULT gen_random_uuid()::text,
    
    -- 2. å‘é‡å­—æ®µ (ç»´åº¦æ ¹æ®æ¨¡å‹å†³å®š)
    embedding vector(1536), -- OpenAI embeddingç»´åº¦
    
    -- 3. å…³è”å­—æ®µ
    document_id VARCHAR(36) NOT NULL,    -- å…³è”æ–‡æ¡£ID
    content TEXT NOT NULL,               -- åŸå§‹å†…å®¹
    content_hash VARCHAR(64),            -- å†…å®¹hashï¼Œé¿å…é‡å¤
    
    -- 4. å…ƒæ•°æ®
    model_name VARCHAR(50) DEFAULT 'text-embedding-ada-002',
    chunk_index INTEGER DEFAULT 0,      -- æ–‡æ¡£åˆ†å—ç´¢å¼•
    token_count INTEGER,                -- tokenæ•°é‡
    
    -- 5. æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- 6. ç´¢å¼•
    UNIQUE(document_id, content_hash)
);

-- å‘é‡ç´¢å¼• (æé«˜ç›¸ä¼¼åº¦æœç´¢æ€§èƒ½)
CREATE INDEX ON document_embeddings USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);

-- ä¼ ç»Ÿç´¢å¼•
CREATE INDEX idx_document_embeddings_document_id ON document_embeddings(document_id);
CREATE INDEX idx_document_embeddings_created_at ON document_embeddings(created_at);
```

### å‘é‡æŸ¥è¯¢è§„èŒƒ

```sql
-- ç›¸ä¼¼åº¦æœç´¢ (ä½™å¼¦ç›¸ä¼¼åº¦)
SELECT 
    id, content, document_id,
    1 - (embedding <=> '[0.1,0.2,0.3,...]'::vector) as similarity
FROM document_embeddings 
ORDER BY embedding <=> '[0.1,0.2,0.3,...]'::vector
LIMIT 10;

-- æ¬§å‡ é‡Œå¾—è·ç¦»æœç´¢
SELECT id, content, embedding <-> '[0.1,0.2,0.3,...]'::vector as distance
FROM document_embeddings 
ORDER BY embedding <-> '[0.1,0.2,0.3,...]'::vector
LIMIT 10;

-- ç»“åˆæ¡ä»¶çš„å‘é‡æœç´¢
SELECT *
FROM document_embeddings 
WHERE document_id = ? 
ORDER BY embedding <=> ?::vector
LIMIT 5;
```

------

## ğŸ”— è·¨æ•°æ®åº“å…³è”çº¦æŸ

### æ•°æ®ä¸€è‡´æ€§è§„åˆ™

```
1. ä¸»å®ä½“å­˜å‚¨åœ¨MySQL (å¦‚ç”¨æˆ·ã€è®¢å•)
2. æ‰©å±•ä¿¡æ¯å­˜å‚¨åœ¨MongoDB (å¦‚æ—¥å¿—ã€æ´»åŠ¨è®°å½•)  
3. AIç›¸å…³æ•°æ®å­˜å‚¨åœ¨PostgreSQL (å¦‚å‘é‡ã€æ¨è)

å…³è”æ–¹å¼ï¼š
- ä½¿ç”¨UUIDä½œä¸ºè·¨æ•°æ®åº“çš„å¤–é”®
- MySQLçš„ä¸»é”® â†’ MongoDBçš„å…³è”å­—æ®µ
- MySQLçš„ä¸»é”® â†’ PostgreSQLçš„å…³è”å­—æ®µ
```

### æ•°æ®åŒæ­¥ç­–ç•¥

```java
// ç¤ºä¾‹ï¼šç”¨æˆ·åˆ›å»ºæ—¶çš„å¤šæ•°æ®åº“æ“ä½œ
@Service
@Transactional
public class UserService {
    
    public void createUser(User user) {
        // 1. MySQLå­˜å‚¨ä¸»è¦ä¿¡æ¯
        User savedUser = userRepository.save(user);
        
        // 2. MongoDBè®°å½•æ“ä½œæ—¥å¿—
        SystemLog log = new SystemLog();
        log.setUserId(savedUser.getId());
        log.setMessage("ç”¨æˆ·åˆ›å»ºæˆåŠŸ");
        logRepository.save(log);
        
        // 3. PostgreSQLåˆå§‹åŒ–ç”¨æˆ·å‘é‡
        initUserEmbedding(savedUser.getId());
    }
}
```

------

## ğŸ“ å®Œæ•´æ•°æ®åº“çº¦æŸæç¤ºè¯

```
ã€æ•°æ®åº“è®¾è®¡çº¦æŸã€‘
ä»…é™ä¸‰ç§æ•°æ®åº“ï¼šMySQL(ä¸šåŠ¡æ ¸å¿ƒ) + MongoDB(æ—¥å¿—æ–‡æ¡£) + PostgreSQL(AIå‘é‡)

ã€MySQLçº¦æŸã€‘
- è¡¨å/å­—æ®µåï¼šsnake_case
- ä¸»é”®ï¼šVARCHAR(36) UUID 
- å¿…é¡»å­—æ®µï¼šid, created_at, updated_at
- æ¨èå­—æ®µï¼šdeleted, version
- ç´¢å¼•ï¼šä¸»è¦æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•

ã€MongoDBçº¦æŸã€‘
- é›†åˆåï¼šsnake_caseå¤æ•°å½¢å¼
- æ–‡æ¡£ç»“æ„ï¼šåµŒå¥—å¯¹è±¡ã€æ•°ç»„åˆç†ä½¿ç”¨
- ç´¢å¼•ï¼šæŸ¥è¯¢å­—æ®µã€å¤åˆç´¢å¼•ã€æ–‡æœ¬ç´¢å¼•
- å…³è”ï¼šä½¿ç”¨MySQLçš„UUIDä½œä¸ºå¤–é”®

ã€PostgreSQLçº¦æŸã€‘  
- å¿…é¡»å®‰è£…pgvectoræ‰©å±•
- å‘é‡å­—æ®µï¼švector(1536)
- å‘é‡ç´¢å¼•ï¼šivfflat + vector_cosine_ops
- æŸ¥è¯¢ï¼š<=> ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œ<-> æ¬§å‡ é‡Œå¾—è·ç¦»

ã€è·¨åº“å…³è”ã€‘
UUIDä½œä¸ºç»Ÿä¸€ä¸»é”®ï¼ŒMySQLä¸»å®ä½“ â†’ MongoDBæ‰©å±• â†’ PostgreSQLå‘é‡
```

------

## âœ… æ•°æ®åº“è®¾è®¡æ£€æŸ¥æ¸…å•

**MySQLæ£€æŸ¥ï¼š**

- [ ] è¡¨åä½¿ç”¨snake_caseå¤æ•°å½¢å¼
- [ ] ä¸»é”®ä¸ºVARCHAR(36) UUIDç±»å‹
- [ ] åŒ…å«created_atã€updated_atå­—æ®µ
- [ ] é‡è¦æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•
- [ ] å­—æ®µç±»å‹é€‰æ‹©åˆç†

**MongoDBæ£€æŸ¥ï¼š**

- [ ] é›†åˆåä½¿ç”¨snake_caseå¤æ•°å½¢å¼
- [ ] æ–‡æ¡£ç»“æ„è®¾è®¡åˆç†
- [ ] æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•
- [ ] ä½¿ç”¨MySQLçš„UUIDå…³è”

**PostgreSQLæ£€æŸ¥ï¼š**

- [ ] å®‰è£…pgvectoræ‰©å±•
- [ ] å‘é‡å­—æ®µå®šä¹‰æ­£ç¡®
- [ ] å‘é‡ç´¢å¼•åˆ›å»ºå®Œæ•´
- [ ] ç›¸ä¼¼åº¦æŸ¥è¯¢è¯­æ³•æ­£ç¡®

**è·¨åº“è®¾è®¡æ£€æŸ¥ï¼š**

- [ ] UUIDç»Ÿä¸€ä¸»é”®ç­–ç•¥
- [ ] æ•°æ®åº“èŒè´£åˆ’åˆ†æ¸…æ™°
- [ ] å…³è”å…³ç³»è®¾è®¡åˆç†
- [ ] æ•°æ®åŒæ­¥ç­–ç•¥æ˜ç¡®

è¿™æ ·å¯ä»¥ç¡®ä¿æ•°æ®åº“è®¾è®¡çš„è§„èŒƒæ€§å’Œä¸€è‡´æ€§ï¼